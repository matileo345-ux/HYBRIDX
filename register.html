<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - HYBRIDX</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="header-left">
      <img src="logo.png" alt="HYBRIDX" class="logo-img">
      <div class="logo-text">HYBRIDX</div>
    </div>
    <a href="index.html" class="about-btn">‚Üê Back</a>
  </header>

  <main>
    <section class="hero">
      <div class="tag" id="stepTag">STEP 1 OF 3</div>
      <h1 id="stepTitle">Enter Your <span class="gradient-text">Email</span></h1>
      <p class="hero-text" id="stepDesc">Get your exclusive referral code to share with friends and earn bonus BNB.</p>

      <!-- Progress Steps -->
      <div class="steps">
        <div class="step active" id="step1Indicator"><span>1</span>Email</div>
        <div class="step" id="step2Indicator"><span>2</span>Deposit</div>
        <div class="step" id="step3Indicator"><span>3</span>Wallet</div>
      </div>

      <!-- STEP 1: EMAIL -->
      <div class="email-box" id="emailStep">
        <input type="email" id="email" placeholder="your@email.com" style="margin-bottom: 16px;">
        
        <div style="background: rgba(102, 126, 234, 0.05); padding: 16px; border-radius: 8px; margin-bottom: 16px; border: 1px solid rgba(102, 126, 234, 0.2);">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Have a Referral Code? (Optional)</label>
          <input type="text" id="referralCodeInput" placeholder="HYBX123456" style="margin-bottom: 0; text-transform: uppercase;">
          <p style="font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-top: 8px;">Enter a friend's referral code to help them earn bonuses</p>
        </div>
        
        <button class="generate-btn" onclick="submitEmail()">Generate Referral Code ‚Üí</button>
        <p style="font-size: 13px; color: rgba(255, 255, 255, 0.5); margin-top: 12px; text-align: center;">We'll never spam you ‚Äî just updates & bonuses.</p>
      </div>

      <!-- STEP 2: DEPOSIT -->
      <div class="email-box" id="depositStep" style="display: none;">
        <div style="background: rgba(234, 179, 8, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(234, 179, 8, 0.3);">
          <p style="font-size: 13px; color: rgba(255, 255, 255, 0.8); line-height: 1.6;">
            ‚ö†Ô∏è <strong>Important:</strong> Only send BNB on BSC (BEP20) network. Wrong network = loss of funds.
          </p>
        </div>

        <div style="background: rgba(102, 126, 234, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(102, 126, 234, 0.3);">
          <p style="font-size: 14px; color: rgba(255, 255, 255, 0.7); margin-bottom: 8px;">‚úÖ Your Referral Code:</p>
          <p id="displayRefCode" style="font-size: 24px; font-weight: 700; color: #667eea; letter-spacing: 1px;"></p>
        </div>

        <div style="background: rgba(255, 255, 255, 0.03); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <p style="font-size: 14px; color: rgba(255, 255, 255, 0.6); margin-bottom: 12px;">Deposit Address (BSC):</p>
          <div style="background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 6px; word-break: break-all; font-family: monospace; font-size: 13px; margin-bottom: 12px;">
            <p id="depositAddress">0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb5</p>
          </div>
          <button class="generate-btn" onclick="copyAddress()" style="background: rgba(102, 126, 234, 0.2); width: 100%; margin-bottom: 0;">
            üìã Copy Address
          </button>
        </div>

        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Deposit Amount (Minimum 2 BNB)</label>
        <input type="number" id="depositAmount" placeholder="2.0000" min="2" step="0.0001" style="margin-bottom: 16px;">

        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Transaction Hash</label>
        <input type="text" id="txHash" placeholder="0x..." style="margin-bottom: 16px; font-family: monospace;">
        <p style="font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-top: -8px; margin-bottom: 16px;">Paste your transaction hash from BSCScan</p>

        <button class="generate-btn" onclick="submitDeposit()">Continue to Wallet ‚Üí</button>
      </div>

      <!-- STEP 3: WALLET -->
      <div class="email-box" id="walletStep" style="display: none;">
        <div style="background: rgba(234, 179, 8, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(234, 179, 8, 0.3);">
          <p style="font-size: 13px; color: rgba(255, 255, 255, 0.8); line-height: 1.6;">
            ‚ö†Ô∏è <strong>Important:</strong> Make sure your wallet is set to Binance Smart Chain (BSC) network.
          </p>
        </div>

        <div style="background: rgba(16, 185, 129, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(16, 185, 129, 0.3);">
          <p style="font-size: 14px; color: rgba(255, 255, 255, 0.7); margin-bottom: 8px;">‚úÖ Deposit Confirmed:</p>
          <p id="displayDepositAmount" style="font-size: 20px; font-weight: 700; color: #10b981;"></p>
        </div>

        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Your BSC Wallet Address (That You Deposited From)</label>
        <input type="text" id="walletAddress" placeholder="0x..." style="margin-bottom: 16px; font-family: monospace;">
        <p style="font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-top: -8px; margin-bottom: 20px;">Enter the same wallet address you used to send the BNB deposit</p>

        <button class="generate-btn" onclick="submitWallet()" style="width: 100%; margin-bottom: 16px;">
          Submit Wallet Address ‚Üí
        </button>

        <div style="text-align: center; margin: 20px 0;">
          <p style="font-size: 14px; color: rgba(255, 255, 255, 0.5);">‚Äî OR ‚Äî</p>
        </div>

        
      </div>
    </section>

    <footer>
      <a href="https://x.com/HYBRIDX_HYBX" class="follow-btn">Follow X</a>
    </footer>
  </main>

  <script src="script.js"></script>
  <script>
    const DEPOSIT_ADDRESS = '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb5';
    let currentStep = 1;

    // Check if user has existing progress
    window.addEventListener('DOMContentLoaded', function() {
      // Check for referral code in URL
      const urlParams = new URLSearchParams(window.location.search);
      const refCode = urlParams.get('ref');
      if (refCode) {
        document.getElementById('referralCodeInput').value = refCode.toUpperCase();
      }
      
      const userDataStr = localStorage.getItem('hybridx_user');
      if (userDataStr) {
        const userData = JSON.parse(userDataStr);
        if (userData.walletConnected) {
          window.location.href = 'success.html';
        } else if (userData.depositCompleted) {
          goToStep(3);
        } else if (userData.referralCode) {
          goToStep(2);
        }
      }
    });

    function goToStep(step) {
      currentStep = step;
      
      // Hide all steps
      document.getElementById('emailStep').style.display = 'none';
      document.getElementById('depositStep').style.display = 'none';
      document.getElementById('walletStep').style.display = 'none';
      
      // Remove active class from all step indicators
      document.getElementById('step1Indicator').classList.remove('active');
      document.getElementById('step2Indicator').classList.remove('active');
      document.getElementById('step3Indicator').classList.remove('active');
      
      // Show current step
      if (step === 1) {
        document.getElementById('stepTag').textContent = 'STEP 1 OF 3';
        document.getElementById('stepTitle').innerHTML = 'Enter Your <span class="gradient-text">Email</span>';
        document.getElementById('stepDesc').textContent = 'Get your exclusive referral code to share with friends and earn bonus BNB.';
        document.getElementById('emailStep').style.display = 'block';
        document.getElementById('step1Indicator').classList.add('active');
      } else if (step === 2) {
        document.getElementById('stepTag').textContent = 'STEP 2 OF 3';
        document.getElementById('stepTitle').innerHTML = 'Deposit <span class="gradient-text">$2 BNB</span>';
        document.getElementById('stepDesc').textContent = 'Send minimum $2 BNB to secure your $50 BNB launchpool allocation.';
        document.getElementById('depositStep').style.display = 'block';
        document.getElementById('step2Indicator').classList.add('active');
        
        // Display referral code
        const userDataStr = localStorage.getItem('hybridx_user');
        if (userDataStr) {
          const userData = JSON.parse(userDataStr);
          if (userData.referralCode) {
            document.getElementById('displayRefCode').textContent = userData.referralCode;
          }
        }
      } else if (step === 3) {
        document.getElementById('stepTag').textContent = 'STEP 3 OF 3';
        document.getElementById('stepTitle').innerHTML = 'Submit Your <span class="gradient-text">Wallet</span>';
        document.getElementById('stepDesc').textContent = 'Enter the BSC wallet address you used to deposit from.';
        document.getElementById('walletStep').style.display = 'block';
        document.getElementById('step3Indicator').classList.add('active');
        
        // Display deposit amount
        const userDataStr = localStorage.getItem('hybridx_user');
        if (userDataStr) {
          const userData = JSON.parse(userDataStr);
          if (userData.depositAmount) {
            document.getElementById('displayDepositAmount').textContent = userData.depositAmount + ' BNB';
          }
        }
      }
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function submitEmail() {
      const email = document.getElementById('email').value.trim();
      const referralCodeInput = document.getElementById('referralCodeInput').value.trim().toUpperCase();
      
      if (!email || !email.includes('@')) {
        alert('Please enter a valid email address');
        return;
      }
      
      // Generate referral code
      const code = 'HYBX' + Math.random().toString(36).substr(2, 6).toUpperCase();
      
      // Prepare user data
      const userData = {
        email: email,
        referralCode: code,
        timestamp: new Date().toISOString()
      };
      
      // If user entered a referral code, save it
      if (referralCodeInput) {
        userData.usedReferralCode = referralCodeInput;
        
        // Track this referral (add to the referrer's count)
        const referrals = JSON.parse(localStorage.getItem('hybridx_referrals') || '{}');
        if (!referrals[referralCodeInput]) {
          referrals[referralCodeInput] = [];
        }
        referrals[referralCodeInput].push({
          email: email,
          timestamp: new Date().toISOString()
        });
        localStorage.setItem('hybridx_referrals', JSON.stringify(referrals));
        
        alert('Success! Your referral code: ' + code + '\n\nYou used referral code: ' + referralCodeInput);
      } else {
        alert('Success! Your referral code: ' + code);
      }
      
      // Store in localStorage
      localStorage.setItem('hybridx_user', JSON.stringify(userData));
      
      setTimeout(() => {
        goToStep(2);
      }, 500);
    }

    function copyAddress() {
      const address = DEPOSIT_ADDRESS;
      
      // Try modern clipboard API
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(address).then(() => {
          alert('Address copied to clipboard!');
        }).catch(() => {
          // Fallback
          fallbackCopy(address);
        });
      } else {
        fallbackCopy(address);
      }
    }
    
    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        alert('Address copied to clipboard!');
      } catch (err) {
        alert('Failed to copy: ' + text);
      }
      document.body.removeChild(textArea);
    }

    function submitDeposit() {
      const amount = parseFloat(document.getElementById('depositAmount').value);
      const txHash = document.getElementById('txHash').value.trim();
      
      if (!amount || amount < 2) {
        alert('Minimum deposit is 2 BNB');
        return;
      }
      
      if (!txHash || !txHash.startsWith('0x') || txHash.length !== 66) {
        alert('Please enter a valid transaction hash (must start with 0x and be 66 characters)');
        return;
      }
      
      // Get existing data
      const userData = JSON.parse(localStorage.getItem('hybridx_user') || '{}');
      
      // Update with deposit info
      userData.depositAmount = amount;
      userData.txHash = txHash;
      userData.depositCompleted = true;
      userData.depositTimestamp = new Date().toISOString();
      
      localStorage.setItem('hybridx_user', JSON.stringify(userData));
      
      alert('Deposit confirmed!');
      
      setTimeout(() => {
        goToStep(3);
      }, 500);
    }

    function submitWallet() {
      const walletAddress = document.getElementById('walletAddress').value.trim();
      
      if (!walletAddress) {
        alert('Please enter your wallet address');
        return;
      }
      
      if (!walletAddress.startsWith('0x') || walletAddress.length !== 42) {
        alert('Please enter a valid BSC wallet address (must start with 0x and be 42 characters)');
        return;
      }
      
      // Get existing data
      const userData = JSON.parse(localStorage.getItem('hybridx_user') || '{}');
      
      // Update with wallet info
      userData.walletAddress = walletAddress;
      userData.walletConnected = true;
      userData.registrationComplete = true;
      userData.completionTimestamp = new Date().toISOString();
      
      localStorage.setItem('hybridx_user', JSON.stringify(userData));
      
      alert('Registration complete! Your $50 BNB allocation is confirmed!');
      
      setTimeout(() => {
        window.location.href = 'success.html';
      }, 1000);
    }

    async function useMetaMask() {
      if (typeof window.ethereum === 'undefined') {
        alert('MetaMask is not installed. Please install MetaMask extension or enter your wallet address manually.');
        window.open('https://metamask.io/download/', '_blank');
        return;
      }
      
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const walletAddress = accounts[0];
        
        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
        
        if (chainId !== '0x38') {
          alert('Please switch to Binance Smart Chain network in MetaMask');
          return;
        }
        
        document.getElementById('walletAddress').value = walletAddress;
        submitWallet();
        
      } catch (error) {
        console.error('MetaMask connection error:', error);
        alert('Failed to connect MetaMask. Please try again or enter address manually.');
      }
    }
  </script>
</body>
</html>
